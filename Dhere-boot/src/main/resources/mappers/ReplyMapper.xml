<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.springbootstudy.dhere.mappers.ReplyMapper">

	

	<!-- 댓글 작성 쿼리 -->
	<insert id="replyWrite" parameterType="reply">
		INSERT 
		INTO	reply(reply_no, reply_content, reply_date, email, story_no)
		VALUES	(#{replyNo}, #{replyContent}, SYSDATE(), #{email}, #{storyNo})
	</insert>
    
	<!-- 댓글 읽어오기 쿼리 -->
    <select id="getReply" resultMap="replyResultMap">
	    SELECT r.reply_no AS 'replyNo',
		           r.reply_content AS 'replyContent',
		           r.reply_date AS 'replyDate',
		           r.email,
		           r.story_no AS 'storyNo',
		           m.nickname,
		           m.picture
	    FROM	reply r
	    JOIN member m ON r.email = m.email
	    WHERE r.story_no = #{storyNo}
	    ORDER BY r.reply_date ASC
	</select>
	<resultMap id="replyResultMap" type="com.springbootstudy.dhere.domain.Reply">
	    <result property="replyNo" column="replyNo" />
	    <result property="replyContent" column="replyContent" />
	    <result property="replyDate" column="replyDate" />
	    <result property="email" column="email" />
	    <result property="storyNo" column="storyNo" />
	    <result property="nickname" column="nickname" />
	    <result property="picture" column="picture" />
	</resultMap>
    
    <!-- storyDetail_삭제 쿼리 추가(syj) -->
	<delete id="deleteReply">
		DELETE 
		FROM 	reply
		WHERE 	reply_no = #{reply_no}
	</delete>
    
</mapper>